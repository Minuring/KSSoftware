<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<style layout:fragment="css"></style>

<div class="container-md mb-lg-5" layout:fragment="content">

    <div class="row mt-5 py-3">
        <div class="col-8">
            <h2 class="text-center">글 상세</h2>
        </div>
        <div class="col-2">
            <button class="btn btn-primary btn-lg"
                    onclick="location.href='edit.html'"
                    th:onclick="|location.href='@{/board/{boardId}/edit(boardId=${board.id})}'|"
                    type="button">글 수정
            </button>
        </div>
        <div class="col-2">
            <button class="btn btn-secondary btn-lg"
                    onclick="location.href='items.html'"
                    th:onclick="|location.href='@{/board}'|"
                    type="button">목록으로
            </button>
        </div>
    </div>

    <div class="container text-center mb-lg-4">
        <div class="row align-items-start mb-3">
            <div class="col-sm-1">
                <label for="boardId">게시글 ID</label>
                <input type="text" id="boardId" name="boardId" class="form-control bg-secondary-subtle" value="1"
                       th:value="${board.id}" readonly>
            </div>
            <div class="col-sm-2">
                <label for="writer">작성자</label>
                <input type="text" id="writer" name="writer" class="form-control bg-secondary-subtle" value="username"
                       th:value="${board.writer.userName} + ' (' + '***' + ${board.writer.userId.substring(3)} + ')'"
                       readonly>
            </div>
            <div class="col-lg">
                <label for="title">제목</label>
                <input type="text" id="title" name="title" class="form-control bg-secondary-subtle" value="제목A"
                       th:value="${board.title}" readonly>
            </div>
        </div>
        <div class="row align-items-start mb-3">
            <div class="col-md">
                <label for="createDate">작성일자</label>
                <input type="text" id="createDate" name="boardCreateDate" class="form-control bg-secondary-subtle"
                       value="yyyymmdd" th:value="${#temporals.format(board.createDate, 'yyyy년 MM월 dd일 HH시 mm분')}"
                       readonly>
            </div>
            <div class="col-md">
                <label for="updateDate">수정일자</label>
                <input type="text" id="updateDate" name="boardUpdateDate" class="form-control bg-secondary-subtle"
                       value="yyyymmdd" th:value="${#temporals.format(board.updateDate, 'yyyy년 MM월 dd일 HH시 mm분')}"
                       readonly>
            </div>
        </div>
    </div>

    <hr class="my-4">

    <div class="container text-center">
        <textarea class="form-control bg-white" th:text="${board.content}" style="min-height: 30rem" disabled></textarea>
    </div>

    <div class="container-md mb-lg-5">

        <!--  Comments Form -->
        <div class="card my-4">
            <h5 class="card-header">댓글 작성하기 </h5>
            <div class="card-body">
                <form role="form" th:action="@{/board/{boardId}/comment/new(boardId=${board.id})}"
                      th:object="${commentCreateDto}" method="post">
                    <textarea class="form-control" th:field="*{content}" rows="3" required></textarea>
                    <div class="form-group d-sm-flex mx-1 mb-1 align-items-center">
                        <button type="submit" class="btn btn-primary mt-2">작성</button>
                        <div class="form-check mx-sm-2">
                            <input class="form-check-input" type="checkbox" th:field="*{anonymousYn}">
                            <label class="form-check-label" th:for="*{anonymousYn}">
                                익명
                            </label>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!--    Single Comment -->
        <div class="d-flex align-items-start" th:each="comment : ${board.comments}">
            <div class="flex-shrink-0 border border-dark-subtle rounded-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor"
                     class="bi bi-person-fill" viewBox="0 0 16 16">
                    <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                </svg>
            </div>
            <div class="flex-grow-1 ms-3">
                <form method="post" th:action="@{{boardId}/comment/delete(boardId=${board.id})}">
                    <div class="d-flex mb-0 top-0">
                        <strong class="d-sm-inline-flex mt-0 mb-sm-1 me-2"
                                th:text="${comment.anonymousYn} ? '익명' : ${comment.writer.userName} + ' (' + '***' + ${comment.writer.userId.substring(3)} + ')'">Commenter Name</strong>
                        <p class="d-sm-inline-flex text-sm-end text-black-50"
                           th:text="${#temporals.format(comment.createDate, 'yyyy.MM.dd HH:mm')}"></p>
                        <button type="button" class="btn bg-white d-flex" data-bs-toggle="modal"
                                data-bs-target="#editCommentModal"
                                th:onclick="clickEditComment(/*[[${comment.id}]]*/, /*[[${comment.content}]]*/ );">

                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="20" height="20"
                                 class="bi bi-pencil-square d-sm-inline-flex top-0 mt-0" viewBox="0 0 16 16">
                                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                                <path fill-rule="evenodd"
                                      d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
                            </svg>
                        </button>

                        <input type="hidden" name="commentId" th:value="${comment.id}">
                        <button type="submit" class="t btn-close d-sm-inline-flex"></button>
                    </div>
                    <div class="form-floating mb-3">
                        <textarea class="form-control" th:text="${comment.content}" id="floatingTextarea2Disabled" style="height: 100px" disabled></textarea>
                        <label for="floatingTextarea2Disabled">Comments</label>
                    </div>
                </form>
            </div>

            <!--    댓글 수정 모달 폼      -->
            <div class="modal fade" id="editCommentModal" tabindex="-1" aria-labelledby="editCommentModal"
                 aria-hidden="true">
                <div class="modal-dialog">
                    <form id="commentEditForm" role="form" th:action="@{{boardId}/comment/edit(boardId=${board.id})}"
                          th:object="${commentUpdateDto}" method="post">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="editCommentModalLabel">Edit Comment</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <input id="commentId" type="hidden" th:field="*{commentId}">
                                <div class="mb-3">
                                    <label th:for="*{content}" class="col-form-label">내용:</label>
                                    <textarea class="form-control" th:field="*{content}" th:text="${content}" id="commentText" style="height: 100px" required></textarea>

                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                                <button type="submit" class="btn btn-primary" id="editCommentSubmitBtn">저장
                                </button>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </div>

        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="messageToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                    </svg>
                    <strong class="me-auto">KSSoftware</strong>
                    <small>now</small>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body" id="toast-message">
                    토스트 메시지
                </div>
            </div>
        </div>

    </div>
    <script th:inline="javascript">
        window.onload = function() {
            var redirectStatus = [[${param.redirectStatus}]];
            if (redirectStatus) {
                triggerToast(redirectStatus);
            }
        }
        const MESSAGE_MAP = new Map([
            ["commentCreated", "정상적으로 댓글이 작성되었습니다."],
            ["commentEdited", "정상적으로 댓글이 수정되었습니다."],
            ["commentDeleted", "정상적으로 댓글이 삭제되었습니다."],
        ]);
        function triggerToast(redirectStatus) {
            const toast = document.getElementById('messageToast');
            const toastMessageDOM = document.getElementById("toast-message");
            const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toast)

            toastMessageDOM.innerHTML = MESSAGE_MAP.get(redirectStatus+'');
            toastBootstrap.show();
        }
        function clickEditComment(commentId, content) {
            document.getElementById('commentId').setAttribute('value', commentId);
            document.getElementById('commentText').innerHTML = content;
        }

    </script>

</div> <!-- /container -->
</html>